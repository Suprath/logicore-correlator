# FILE: worker/rules.yaml

# Maps keywords from an incident alert summary to the appropriate CodeQL query suite.
# The first rule with a matching keyword will be used.

mappings:
  # --- HIGH-PRIORITY: Security Scan ---
  # Triggered by keywords related to security events.
  - name: "Security and Quality Scan"
    alert_keywords:
      - "vulnerability"
      - "suspicious"
      - "injection"
      - "xss"
      - "cross-site"
      - "unauthorized"
      - "security"
    # This is the most comprehensive security suite.
    codeql_suite: "python/ql/src/codeql-suites/python-security-and-quality.qls"

  # --- MEDIUM-PRIORITY: Reliability / Crash Analysis ---
  # Triggered by keywords related to application errors and crashes.
  - name: "Reliability and Error Scan"
    alert_keywords:
      - "error"
      - "exception"
      - "npe"
      - "null pointer"
      - "crash"
      - "5xx"
      - "500"
      - "503"
    # This suite finds common bug patterns that lead to crashes.
    codeql_suite: "python/ql/src/codeql-suites/python-code-quality.qls"

  # --- MEDIUM-PRIORITY: Performance Analysis ---
  # Triggered by keywords related to slowness.
  - name: "Performance Scan"
    alert_keywords:
      - "latency"
      - "p99"
      - "slow"
      - "timeout"
    # This suite finds performance-related issues like potential ReDoS.
    codeql_suite: "python/ql/src/codeql-suites/python-performance.qls"

  # --- DEFAULT: Fallback Scan ---
  # If no other keywords match, run a general security scan.
  - name: "Default Security Scan"
    alert_keywords: ["default"] 
    codeql_suite: "python/ql/src/codeql-suites/python-security-and-quality.qls"